---
title: Solución Ropemporium ret2csu
date: 2024-01-21
categories: [rop, 64bits, bof]
tags: [64bits, bof, rop]
---
# **Introducción**

Último post de **ropemporium**, en el enunciado de la web nos dicen lo siguiente, que este challenge es muy parecido a **callme** que simplemente tenemos que llamar `ret2win()` con 3 parámetros de la siguiente forma  ``ret2win(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)`` 


## **Direcciones de gadgets y funciones**
Empezaremos mirando la función `ret2win()`, para eso podemos usar **pwndbg** y ver la función de `usefulFunction` que hace un call a `ret2win` y veremos la dirección de memoria de la función como muestro en la siguiente imagen.
![ret2win](/assets/img/rop/ret2csu.png)

No tenemos ningún **gadget** que nos permita hacer un `pop rbx`,  si investigamos `__libc_csu_init` podemos ver que hay un `pop rbx`
![ret2win](/assets/img/rop/poprbx.png)

Vale, necesitamos ahora el **gadget** número dos que tendría que ser un `mov rdx rsi`, pero otra vez si buscamos gadgets no hay ninguno, si nos fijamos otra vez en la función `__libc_csu_init` de allí sacaremos el **gadget** `` 0x0000000000400680 <+64>:	mov    rdx,r15``

Y por último, nos faltaría `st_value` que es ``0x4003b0``, que es la región de memoria donde se inicia `_fini`.
# **Exploit**

![lib](/assets/img/rop/RET2SCU.png)